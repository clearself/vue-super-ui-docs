import{m as ge,n as ae,o as he,p as fe,E as _e,q as we,r as be,t as xe,u as ke,w as Te,x as Ie}from"./theme.gqej5HM7.js";import"./el-loading.w40geAFS.js";import"./el-input.w40geAFS.js";import"./el-icon.w40geAFS.js";import"./el-image-viewer.w40geAFS.js";import"./el-button.w40geAFS.js";import{d as Ee,a as d,w as F,c as _,e as o,f as p,g as w,L as Ce,E as i,v as h,y as f,G as z,i as le,j as b,J,I as H,D as Se,n as se,H as oe,W as $e,X as Be,aF as Fe}from"./framework.54wzUQT-.js";import{T as L}from"./Text.dT2Kgdrg.js";import{_ as ze}from"./Title.vue_vue_type_script_setup_true_lang.PerqAy1r.js";const O=x=>($e("data-v-ea727131"),x=x(),Be(),x),Le={class:"min-h100","element-loading-background":"rgba(0, 0, 0, 0)"},Re={class:"topic-content"},De={key:2,class:"options"},Ve=O(()=>i("div",{class:"image-slot"},[i("p",null,"图片加载中...")],-1)),Ke=O(()=>i("div",{class:"image-slot"},[i("p",null,"图片加载失败...")],-1)),Ne=["src"],Me=O(()=>i("div",{class:"placeholder-box"},null,-1)),He={class:"answer-container"},Ue={class:"sticky"},je={key:0},Ae={class:"input-box"},ne=60,Je=Ee({__name:"guessit",props:{api:{},type:{},name:{},isPrompt:{type:Boolean,default:!0}},setup(x){const u=x,k=d(!1),t=d(),T=d(""),R=d([]),D=d(),n=d(3),m=d(!0),P=d();F(m,()=>{m.value||P.value.focus()});let I=Date.now(),E=0;const c=e=>new Promise(a=>{const l=Symbol("push");e.pushMsgKey=l,R.value.push(e);const r=R.value.find(B=>B.pushMsgKey===l);if(e.notTypeIt)return a(r);const g=F(r,()=>{r.isTypeItEnd&&(a(r),g(),delete r.pushMsgKey)})}),Z=async()=>{await c({value:`开始${u.name}，每题限时 ${ne} 秒，低于 0 分游戏结束！`}),await C(),I=Date.now(),n.value=3};F(()=>R.value.length,async()=>{await se(),setTimeout(()=>{D.value&&(D.value.scrollTop=D.value.scrollHeight)},30)});const q=async()=>{const e=await c({value:"数据加载失败...",btnText:"重新获取",btnFun:()=>{delete e.btnFun,delete e.btnText,C()}})},C=async()=>{k.value=!0,await c({value:"正在加载数据..."});try{const{data:e}=await u.api(u.type);t.value=e}catch{const e=await c({value:"加载数据失败...",btnText:"重新加载",btnFun:()=>{delete e.btnFun,delete e.btnText,C()}})}finally{k.value=!1}};Z();const v=_(()=>{var a,l;if((a=t.value)!=null&&a.audioBase64)return ge(t.value.audioBase64,"audio/mpeg");const e=(l=t.value)!=null&&l.path?Array.isArray(t.value.path)?t.value.path[ae(0,t.value.path.length-1)]:t.value.path:"";return e==null?void 0:e.replace(/^(\.\/src)|(\.\.)/,"")});let S,V,$;const re=async()=>{await se(),fe(G.value.$el.children[0]).update({background:"var(--el-color-info-light-9)"}),K()},ue=()=>{var e;v.value||(e=t.value)!=null&&e.desc||(t.value&&(t.value.isTopicTypeItEnd=!0),K())},ce=()=>{v.value||K()},K=async()=>{t.value.audioCanplay=!0,m.value=!1,clearInterval(S),clearInterval(V);let e=ne,a={value:`⏳还剩 ${e} 秒！`,notTypeIt:!0};$=await c(a),S=setInterval(async()=>{var l;$.value=`⏳还剩 ${--e} 秒！`,e<=0&&($.lineThrough=!0,clearInterval(S),await c({value:`😜时间到！没猜对。答案是「${t.value.answer}」${(l=t.value)!=null&&l.singer?" -- "+t.value.singer:""}。`}),n.value--,n.value&&C())},1e3),u.isPrompt&&(V=setTimeout(async()=>{var g;const l=((g=t.value)==null?void 0:g.answer)||"";if(!l)return;const r=ae(0,l.length-1);await c({value:"提示："+(l.length===1?"一个字":l.split("").map((B,A)=>r===A?B:"◼").join(""))})},parseInt(e*1e3/2+"")))},G=d(),N=_(()=>/^http/.test(v.value)),ie=_(()=>(/^\//.test(v.value)||N.value)&&/(\.png|\.jpg|\.gif|\.webp)$/.test(v.value)),ve=_(()=>(/^\//.test(v.value)||N.value)&&/\.mp3$/.test(v.value)),U=_(()=>{var e;return N.value||(e=t.value)!=null&&e.audioBase64?"":he}),y=d(JSON.parse(window.localStorage.getItem("games"))||{}),W=()=>{var e,a;(e=y.value)[a=u.name]??(e[a]={highestScore:3,list:[{key:I,score:n.value,correctCount:E}]}),y.value[u.name].list.find(l=>l.key===I)||y.value[u.name].list.push({key:I,score:n.value,correctCount:E})};W();const de=_(()=>y.value[u.name].list.sort((e,a)=>a.score-e.score)[0].score);F(y,()=>{window.localStorage.setItem("games",JSON.stringify(y.value))},{deep:!0}),F(n,async()=>{W();const e=y.value[u.name].list.find(a=>a.key===I);if(e.correctCount=E,n.value>e.score&&(e.score=n.value),n.value<=0){$.lineThrough=!0,m.value=!0;const a=await c({value:`😜游戏结束，累计答对${E}个。[加群](/docs/关于/交流群.html)有相同功能机器人！`,btnText:"再玩一次",btnFun:()=>{delete a.btnFun,delete a.btnText,Z()}});n.value=0,clearInterval(S),clearInterval(V)}});const pe=e=>{T.value=e,j()},j=async()=>{var r,g;const e=T.value.toLowerCase().trim();if(!e)return;m.value=!0;const a=(g=(r=t.value)==null?void 0:r.answer)==null?void 0:g.toLowerCase();T.value="";const l=a===e;l?(E++,n.value++,$.lineThrough=!0,clearInterval(S),clearInterval(V),await c({value:a,answers:l}),n.value>y.value[u.name].highestScore&&(y.value[u.name].highestScore=n.value,await c({value:"🎉超过了最高分，当前得分"+n.value})),await C()):(await c({value:e,answers:l,html:!1}),n.value--,m.value=!1)};return(e,a)=>{var X,Q,Y,ee,te;const l=_e,r=we,g=ke,B=Te,A=Ie,me=be,ye=xe;return o(),p(z,null,[w(ze,{title:e.name,style:{"margin-top":"0"}},null,8,["title"]),Ce((o(),p("div",Le,[i("div",Re,[(X=t.value)!=null&&X.topic?(o(),h(L,{key:t.value.topic,text:t.value.topic,style:{"font-size":"20px",margin:"0 0 16px 0"},loading:"",once:"",interval:40,html:"",onEnd:ue},null,8,["text"])):f("",!0),(Q=t.value)!=null&&Q.desc?(o(),h(L,{key:t.value.desc,text:t.value.desc,style:{"font-size":"18px",margin:"0 0 16px 0"},loading:"",once:"",interval:50,html:"",onEnd:ce},null,8,["text"])):f("",!0),(Y=t.value)!=null&&Y.topic&&t.value.isTopicTypeItEnd?(o(),p("div",De,[(o(!0),p(z,null,le((ee=t.value)==null?void 0:ee.options,s=>(o(),h(l,{text:"",bg:"",size:"large",disabled:m.value||k.value,onClick:M=>pe(s)},{default:b(()=>[J(H(s),1)]),_:2},1032,["disabled","onClick"]))),256))])):f("",!0),ie.value?(o(),h(r,{ref_key:"imgRef",ref:G,src:U.value+v.value,key:U.value+v.value,referrerpolicy:N.value?"no-referrer":void 0,fit:"cover",onLoad:re,onError:q},{placeholder:b(()=>[Ve]),error:b(()=>[Ke]),_:1},8,["src","referrerpolicy"])):f("",!0),ve.value||(te=t.value)!=null&&te.audioBase64?(o(),p("audio",{key:4,src:U.value+v.value,controls:"",onCanplay:a[0]||(a[0]=s=>{var M;return!((M=t.value)!=null&&M.audioCanplay)&&K()}),onError:q},null,40,Ne)):f("",!0),Me]),i("div",He,[i("ol",{class:"msg",ref_key:"msgRef",ref:D},[i("li",Ue,[J(" 当前分数: "+H(n.value)+" ",1),i("span",null,"最高分："+H(de.value),1)]),(o(!0),p(z,null,le(R.value,s=>(o(),p("li",{style:oe({textDecoration:s.lineThrough?"line-through":""})},[s.notTypeIt?(o(),p("span",je,H(s.value),1)):(o(),h(L,{key:1,text:s.value,loading:"",once:"",interval:60,html:s.html,onEnd:M=>s.isTypeItEnd=!0},null,8,["text","html","onEnd"])),s.isTypeItEnd?(o(),p(z,{key:2},["answers"in s?(o(),p(z,{key:0},[w(A,{style:{height:"28px"}},{default:b(()=>[s.answers?(o(),h(g,{key:0,style:{color:"var(--el-color-success)"}})):(o(),h(B,{key:1,style:{color:"var(--el-color-error)"}}))]),_:2},1024),w(L,{style:oe({color:`var(${s.answers?"--el-color-success":"--el-color-error"})`}),text:s.answers?"🎉答对啦，+1 分":"😜答错啦，-1 分",loading:"",once:""},null,8,["style","text"])],64)):f("",!0),s.btnText?(o(),h(l,{key:1,type:"primary",size:"small",onClick:s.btnFun,text:"",bg:""},{default:b(()=>[w(L,{text:s.btnText,loading:"",once:""},null,8,["text"])]),_:2},1032,["onClick"])):f("",!0)],64)):f("",!0)],4))),256))],512),i("div",Ae,[w(me,{modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=s=>T.value=s),ref_key:"inputRef",ref:P,class:"keyword-input",placeholder:k.value?"正在加载...":"请输入答案",clearable:"",size:"large",maxlength:"50","show-word-limit":"",disabled:m.value,onKeydown:Se(j,["enter"])},null,8,["modelValue","placeholder","disabled"]),w(l,{type:"primary",onClick:j,disabled:m.value},{default:b(()=>[J(" 确定 ")]),_:1},8,["disabled"])])])])),[[ye,k.value]])],64)}}}),et=Fe(Je,[["__scopeId","data-v-ea727131"]]);export{et as g};
